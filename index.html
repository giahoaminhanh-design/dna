<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bản đồ Đông Nam Á </title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    *{box-sizing:border-box}html,body{margin:0;padding:0;height:100%}
    :root{--bg:#f1f5f9;--card:#ffffff;--ink:#0f172a;--muted:#64748b;--accent:#22c55e;--blue:#60a5fa;--stroke:#1e3a8a;--shadow:0 10px 30px rgba(2,6,23,.15)}
    body{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    header{padding:20px 16px;text-align:center}
    header h1{margin:0;font-size:26px}
    .subtitle{color:var(--muted);margin-top:6px}
    main{height:calc(100% - 120px);padding:0 16px 20px;position:relative}
    #map{height:100%;width:100%;border:1px solid #cbd5e1;border-radius:14px;box-shadow:var(--shadow);background:#fff}
    .status{position:absolute;left:20px;bottom:26px;background:#111827;color:#fff;padding:8px 12px;border-radius:8px;opacity:.9;max-width:70%;font-size:12px;display:none}
    footer{padding:12px;text-align:center;color:var(--muted)}
    .modal.hidden{display:none}
    .modal{position:fixed;inset:0;display:grid;place-items:center;z-index:10000}
    .modal__backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45)}
    .modal__dialog{position:relative;background:#fff;border-radius:16px;box-shadow:var(--shadow);width:min(90vw,520px);padding:20px 20px 24px;animation:pop .18s ease-out}
    .modal__title{margin:4px 0 12px 0;color:var(--accent);font-size:22px}
    .modal__close{position:absolute;right:10px;top:6px;border:0;background:transparent;font-size:28px;line-height:1;cursor:pointer}
    @keyframes pop{from{opacity:0;transform:scale(.96)}to{opacity:1;transform:scale(1)}}
    .modal__body { white-space: pre-wrap; }
    .modal__body p {
      margin: 4px 0;
      line-height: 1.35;
    }

  </style>
</head>
<body>
  <header>
    <h1>BẢN ĐỒ ĐÔNG NAM Á</h1>
    <p class="subtitle">Click vào quốc gia để nảy lên và xem thông tin</p>
  </header>

  <main>
    <div id="map" role="img" aria-label="Bản đồ Đông Nam Á"></div>
    <div id="status" class="status"></div>
  </main>

  <div id="modal" class="modal hidden" aria-hidden="true">
    <div class="modal__backdrop" data-close></div>
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <button class="modal__close" title="Đóng" aria-label="Đóng" data-close>&times;</button>
      <h2 id="modal-title" class="modal__title"></h2>
      <div class="modal__body">
      <p><strong>Dân số:</strong> <span id="info-danso"></span></p>
      <p><strong>Xã hội:</strong> <span id="info-xahoi"></span></p>
      <p><strong>Tổng quan:</strong> <span id="info-tongquan"></span></p>
      </div>
    </div>
  </div>

  <footer>Website được phát triển bởi nhóm 2 lớp AV3(2024-2027)</footer>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const STATUS = document.getElementById('status');
    function showStatus(msg, isErr=false){ STATUS.textContent = msg; STATUS.style.display='block'; STATUS.style.background = isErr ? '#7f1d1d' : '#111827'; }
    const ASEAN = new Set(['Vietnam','Thailand','Laos','Cambodia','Myanmar','Malaysia','Singapore','Indonesia','Philippines','Brunei','Timor-Leste']);
    const INFO = {
  Vietnam: {
    dan_so: "Dân số: 101,6 triệu\nTuổi trung vị: 33,4\nĐô thị hóa: 41%\nTFR: 1,88\nTuổi thọ: 74,9 năm",
    xa_hoi: "Ngôn ngữ: Tiếng Việt\nVăn hoá/tôn giáo: Phật giáo, Công giáo\nHDI: 0,715 (Trung bình–cao)\nGDP/người: 4.700 USD\nBiết chữ: 97,9%\nInternet: 78%",
    tong_quan: "Việt Nam ~101,6 triệu dân, đô thị hóa 41%, tăng dân số chậm, già hoá dần.\nHDI trung bình–cao, biết chữ gần toàn dân, hạ tầng xã hội và Internet tiếp tục cải thiện."
  },
  Indonesia: {
    dan_so: "Dân số: 285,7 triệu\nTuổi trung vị: 30,4\nĐô thị hóa: 60%\nTFR: 2,10\nTuổi thọ: 71,4 năm",
    xa_hoi: "Ngôn ngữ: Bahasa Indonesia\nVăn hoá/tôn giáo: Hồi giáo\nHDI: 0,711 (Trung bình)\nGDP/người: 5.460 USD\nBiết chữ: 96%\nInternet: 79%",
    tong_quan: "Indonesia ~285,7 triệu dân, đô thị hóa ~60%, cơ cấu dân số trẻ và lực lượng lao động lớn.\nHDI trung bình, cải thiện nhờ giáo dục và y tế."
  },
  Philippines: {
    dan_so: "Dân số: 116,8 triệu\nTuổi trung vị: 26,1\nĐô thị hóa: 49%\nTFR: 1,88\nTuổi thọ: 70,1 năm",
    xa_hoi: "Ngôn ngữ: Filipino, English\nVăn hoá/tôn giáo: Công giáo\nHDI: 0,699 (Trung bình)\nGDP/người: 4.000 USD\nBiết chữ: 99%\nInternet: 73%",
    tong_quan: "Philippines >116 triệu dân, dân số trẻ (tuổi TB ~26).\nHDI trung bình; mức sinh giảm; kinh tế phụ thuộc dịch vụ và kiều hối."
  },
  Thailand: {
    dan_so: "Dân số: 71,6 triệu\nTuổi trung vị: 40,6\nĐô thị hóa: 54%\nTFR: 1,20\nTuổi thọ: 76,8 năm",
    xa_hoi: "Ngôn ngữ: Tiếng Thái\nVăn hoá/tôn giáo: Phật giáo Theravada\nHDI: 0,803 (Cao)\nGDP/người: 7.800 USD\nBiết chữ: 94%\nInternet: 85%",
    tong_quan: "Thái Lan 71,6 triệu dân, đang già hoá nhanh do mức sinh rất thấp.\nHDI cao, tuổi thọ cao; thách thức về lực lượng lao động già."
  },
  Malaysia: {
    dan_so: "Dân số: 36,0 triệu\nTuổi trung vị: 31,0\nĐô thị hóa: 77%\nTFR: 1,53\nTuổi thọ: 77,0 năm",
    xa_hoi: "Ngôn ngữ: Bahasa Malaysia, English, Chinese, Tamil\nVăn hoá/tôn giáo: Hồi giáo\nHDI: 0,803 (Cao)\nGDP/người: 11.600 USD\nBiết chữ: 95%\nInternet: 92%",
    tong_quan: "Malaysia 36 triệu dân, đô thị hóa cao (77%), dân số trẻ–trung niên.\nHDI cao, thu hút lao động nhập cư, hạ tầng xã hội phát triển."
  },
  Singapore: {
    dan_so: "Dân số: 5,9 triệu\nTuổi trung vị: 36,2\nĐô thị hóa: 100%\nTFR: 0,96\nTuổi thọ: 84,0 năm",
    xa_hoi: "Ngôn ngữ: English, Chinese, Malay, Tamil\nVăn hoá/tôn giáo: Đa tôn giáo\nHDI: 0,939 (Rất cao)\nGDP/người: 90.500 USD\nBiết chữ: 98%\nInternet: 98%",
    tong_quan: "Singapore 5,9 triệu dân, đô thị hóa hoàn toàn; mức sinh thấp nhất khu vực.\nHDI rất cao; tuổi thọ và GDP/người dẫn đầu ASEAN."
  },
  Myanmar: {
    dan_so: "Dân số: 54,9 triệu\nTuổi trung vị: 30,1\nĐô thị hóa: 34%\nTFR: 2,10\nTuổi thọ: 67,3 năm",
    xa_hoi: "Ngôn ngữ: Tiếng Myanmar\nVăn hoá/tôn giáo: Phật giáo Theravada\nHDI: 0,585 (Thấp)\nGDP/người: 1.530 USD\nBiết chữ: 90%\nInternet: 46%",
    tong_quan: "Myanmar 54,9 triệu dân, cơ cấu trẻ, đô thị hóa thấp.\nHDI thấp; hệ thống xã hội và y tế còn nhiều hạn chế."
  },
  Cambodia: {
    dan_so: "Dân số: 17,9 triệu\nTuổi trung vị: 26,2\nĐô thị hóa: 27%\nTFR: 2,50\nTuổi thọ: 71,0 năm",
    xa_hoi: "Ngôn ngữ: Tiếng Khmer\nVăn hoá/tôn giáo: Phật giáo Theravada\nHDI: 0,593 (Trung bình thấp)\nGDP/người: 1.860 USD\nBiết chữ: 83%\nInternet: 58%",
    tong_quan: "Campuchia 17,9 triệu dân, dân số trẻ và đô thị hóa thấp.\nHDI trung bình thấp, giáo dục–y tế cải thiện đáng kể thập kỷ qua."
  },
  Laos: {
    dan_so: "Dân số: 7,9 triệu\nTuổi trung vị: 25,0\nĐô thị hóa: 38%\nTFR: 2,36\nTuổi thọ: 69,5 năm",
    xa_hoi: "Ngôn ngữ: Tiếng Lào\nVăn hoá/tôn giáo: Phật giáo Theravada\nHDI: 0,607 (Trung bình thấp)\nGDP/người: 2.700 USD\nBiết chữ: 85%\nInternet: 57%",
    tong_quan: "Lào gần 7,9 triệu dân, cơ cấu trẻ, tăng dân số khá cao.\nHDI trung bình thấp; hạ tầng và giáo dục đang dần nâng cao."
  },
  Brunei: {
    dan_so: "Dân số: 0,47 triệu\nTuổi trung vị: 32,7\nĐô thị hóa: 80%\nTFR: 1,70\nTuổi thọ: 75,7 năm",
    xa_hoi: "Ngôn ngữ: Bahasa Melayu, English\nVăn hoá/tôn giáo: Hồi giáo\nHDI: 0,830 (Rất cao)\nGDP/người: 79.500 USD\nBiết chữ: 97%\nInternet: 96%",
    tong_quan: "Brunei 0,47 triệu dân, đô thị hóa cao và thu nhập cao.\nHDI rất cao, hệ thống y tế–giáo dục phát triển."
  },
  "Timor-Leste": {
    dan_so: "Dân số: 1,42 triệu\nTuổi trung vị: 21,5\nĐô thị hóa: 36%\nTFR: 2,60\nTuổi thọ: 68,1 năm",
    xa_hoi: "Ngôn ngữ: Tetum, Bồ Đào Nha\nVăn hoá/tôn giáo: Công giáo\nHDI: 0,626 (Trung bình thấp)\nGDP/người: 2.500 USD\nBiết chữ: 70%\nInternet: 53%",
    tong_quan: "Timor-Leste ~1,4 triệu dân, rất trẻ và mức sinh cao.\nHDI trung bình thấp; kinh tế đang phát triển, phụ thuộc nông nghiệp và viện trợ."
  }
};
// Màu cố định cho từng quốc gia
    const COLORS = {
      Vietnam:       '#22c55e', // xanh lá
      Thailand:      '#eab308', // vàng
      Laos:          '#84cc16', // xanh non
      Cambodia:      '#06b6d4', // cyan
      Myanmar:       '#f59e0b', // cam sáng
      Malaysia:      '#3b82f6', // xanh dương
      Singapore:     '#a855f7', // tím
      Indonesia:     '#f97316', // cam
      Philippines:   '#ef4444', // đỏ
      Brunei:        '#0ea5e9', // xanh biển
      'Timor-Leste': '#db2777'  // hồng đậm
};
// ===== ÂM THANH CHO TỪNG QUỐC GIA =====
const AUDIO = {
  "Brunei":        "audio/Brunei.mp3",
  "Cambodia":      "audio/Cambodia.mp3",
  "Indonesia":     "audio/Indonesia.mp3",
  "Laos":          "audio/Laos.mp3",
  "Malaysia":      "audio/Malaysia.mp3",
  "Myanmar":       "audio/Myanmar.mp3",
  "Philippines":   "audio/Philippines.mp3",
  "Singapore":     "audio/Singapore.mp3",
  "Thailand":      "audio/Thailand.mp3",
  "Vietnam":       "audio/Vietnam.mp3",
  // Repo của bạn dùng tên file "East Timor.mp3" nhưng map chuẩn trong code là "Timor-Leste"
  "Timor-Leste":   "audio/East Timor.mp3"
};

let currentAudio = null;   // giữ audio hiện tại
let isMuted = false;       // cho nút mute (tuỳ chọn)

function playCountryAudio(canonName){
  const src = AUDIO[canonName];
  if (!src) return;

  // dừng âm cũ (nếu có)
  if (currentAudio){
    currentAudio.pause();
    currentAudio.currentTime = 0;
  }

  currentAudio = new Audio(src);
  currentAudio.muted = isMuted; // tôn trọng trạng thái mute
  currentAudio.play().catch(err => {
    console.warn("Không phát được audio:", err);
  });
}

// (tuỳ chọn) preload cho mượt
Object.values(AUDIO).forEach(p => { const a = new Audio(); a.preload = "auto"; a.src = p; });

    const map = L.map('map');
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap'}).addTo(map);

    function nameOf(props){ return props.ADMIN || props.NAME || props.NAME_EN || props.name || props.sovereignt; }
    function baseStyle(feature){
      const name = canon(nameOf(feature.properties));
      const fill = COLORS[name] || '#60a5fa';
      return {
        color: '#1e3a8a',
        weight: 1.2,
        fillColor: fill,
        fillOpacity: 0.70
      };
    }
    
    function activeStyle(feature){
      const name = canon(nameOf(feature.properties));
      const fill = COLORS[name] || '#60a5fa';
      return {
        color: '#14532d',
        weight: 1.8,
        fillColor: fill,
        fillOpacity: 0.95
      };
    }

// Map tên nước khác nhau về 1 key chuẩn trong INFO
const ALIAS = {
  'Viet Nam': 'Vietnam',
  "Lao PDR": "Laos",
  "Lao People's Democratic Republic": "Laos",
  'Kingdom of Cambodia': 'Cambodia',
  'Burma': 'Myanmar',
  'Brunei Darussalam': 'Brunei',
  'Timor Leste': 'Timor-Leste',
  'East Timor': 'Timor-Leste'
};
const canon = (n) => ALIAS[n] || n;
function openModal(name){
  const key = ALIAS[name] || name; // chuẩn hoá tên nước
  const m = INFO[key] || { dan_so: '—', xa_hoi: '—', tong_quan: '—' };

  document.getElementById('modal-title').textContent = name;

  // 3 dòng hiển thị 3 mục mới
  document.getElementById('info-danso').textContent    = m.dan_so;
  document.getElementById('info-xahoi').textContent    = m.xa_hoi;
  document.getElementById('info-tongquan').textContent = m.tong_quan;

  const modal = document.getElementById('modal');
  modal.classList.remove('hidden');
  modal.setAttribute('aria-hidden','false');
}
    function closeModal(){
      const modal = document.getElementById('modal');
      modal.classList.add('hidden'); modal.setAttribute('aria-hidden','true');
      if (window.geoLayer) window.geoLayer.eachLayer(l => { l.setStyle(baseStyle(l.feature)); l._active=false; });
    }
    document.addEventListener('click', e => { if (e.target.matches('[data-close]')) closeModal(); });
    document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

    async function tryFetch(url){
      const r = await fetch(url, {mode:'cors'});
      if (!r.ok) throw new Error('HTTP '+r.status); return r.json();
    }

    (async function init(){
      showStatus('Đang tải dữ liệu biên giới...');
      const sources = [
        'https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson',
        'https://cdn.jsdelivr.net/gh/datasets/geo-countries@master/data/countries.geojson',
        'https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json'
      ];
      let geo=null;
      for (const url of sources){
        try { geo = await tryFetch(url); showStatus('Tải từ: '+url); break; }
        catch(e){ /* try next */ }
      }
      if (!geo){ showStatus('Không tải được GeoJSON từ internet. Dùng file local: asean.geojson', true);
        try { const local = await tryFetch('./asean.geojson'); geo = local; }
        catch(e){ showStatus('Thiếu cả asean.geojson. Upload file đó vào repo nhé.', true); return; }
      }
      const feats = (geo.features||[]).filter(f => ASEAN.has(canon(nameOf(f.properties))));
      if (!feats.length){ showStatus('GeoJSON không có ASEAN. Hãy cung cấp asean.geojson đã lọc.', true); return; }
      window.geoLayer = L.geoJSON({type:'FeatureCollection', features:feats}, {
        style: baseStyle,
        onEachFeature: (feature, layer) => {
          const name = nameOf(feature.properties);
          layer.bindTooltip(name, {sticky:true, opacity:0.9});
          layer.on('click', () => {
            window.geoLayer.eachLayer(l => { l.setStyle(baseStyle(l.feature)); l._active=false; });
            layer.setStyle(activeStyle(feature)); if (layer.bringToFront) layer.bringToFront();
            openModal(name);
            playCountryAudio(canon(name));            // <<< THÊM DÒNG NÀY
            layer._active = true; 
          });
          layer.on('mouseover', ()=>{ if (!layer._active) layer.setStyle({ fillOpacity: 0.85 }); });
          layer.on('mouseout',  ()=>{ if (!layer._active) layer.setStyle({ fillOpacity: 0.7  }); });
        }
      }).addTo(map);
      map.fitBounds(window.geoLayer.getBounds(), { padding:[20,20] });
      showStatus('Tải xong. Click vào quốc gia để xem thông tin.');
      setTimeout(()=> STATUS.style.display='none', 2500);
    })();
  </script>
</body>
</html>
